import{d as ce,e as le}from"./chunk-JEZKEUTN.js";import{s as he}from"./chunk-FO2K4ODA.js";import{a as h}from"./chunk-C6O6P6QR.js";import{a as w}from"./chunk-2CJT4ORM.js";import{e as se,g as ne,h as ae,n as oe,s as ue}from"./chunk-LCU4DL3S.js";import{Aa as G,Ba as W,Bb as v,E as M,G as P,Hb as f,Ia as J,Ib as _,Jb as Z,K as U,Nb as K,Qb as Q,Rb as l,Sb as ee,Tb as te,Yb as I,Zb as ie,_ as L,_a as X,_b as re,a as T,b as $,cb as S,e as z,fa as H,ga as Y,j as B,ka as y,l as a,q as x,qa as V,ra as F,sb as b,sc as j,u as g,wb as E,xb as c}from"./chunk-BYEFBY3C.js";var p=class{constructor(e){this.factory=e}buildSingle(e){return this.factory(e)}buildArray(e){return e.map(i=>this.factory(i))}};var pe=new p(t=>{switch(t.type){case w.silent:return new ce(t);case w.reverse:return new le(t);default:throw new Error("Invalid auction DTO")}});var u=function(t){return t.AUCTION_OVER="auction-over",t.AUCTION_EXPIRED="auction-expired",t.AUCTION_ABORTED="auction-aborted",t.NEW_BID="new-bid",t.OUT_BID="out-bid",t.WINNING_BID="winning-bid",t.BID_REJECTED="bid-rejected",t}(u||{}),o=class{constructor(e){this._id=e.id,this._type=e.notificationType,this._read=e.read,this._auction=e.auction?pe.buildSingle(e.auction):null}get id(){return this._id}get type(){return this._type}get read(){return this._read}set read(e){this._read=e}get auction(){return this._auction}get heading(){return""}get message(){return""}get link(){return[]}},R=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"An auction ended"}get message(){return"Your auction awaits a conclusion"}get link(){return["/auction/conclusion",this.auction?.id]}},D=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"An auction expired"}get message(){return"The winning bid was automatically rejected"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},A=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"An auction was deleted"}get message(){return"The auction was deleted by its creator"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},q=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"A new bid"}get message(){return"You have new bids for your auction"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},k=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"Outbid"}get message(){return"You have been outbid"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},N=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"Winning bid"}get message(){return`Your bid of CURRENCY{${this.auction?.lastBid}|${this.auction?.currency}} won`}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},O=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"Bid rejected"}get message(){return`Your bid of CURRENCY{${this.auction?.lastBid}|${this.auction?.currency}} has been rejected`}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},de=new Map([[u.AUCTION_OVER,R],[u.AUCTION_EXPIRED,D],[u.AUCTION_ABORTED,A],[u.NEW_BID,q],[u.OUT_BID,k],[u.WINNING_BID,N],[u.BID_REJECTED,O]]);var me=new p(t=>{let e=de.get(t.notificationType);if(!e)throw new Error("Invalid notification DTO");return new e(t)});var m=class{constructor(e){this.dataSubject=new a(1),this.isEager=!1,this._isComplete=!1,this.data$=this.createDataObservable(),this.http=e.http,this.url=e.url,this.factory=e.factory,this.queryParameters=e.queryParameters,this._pageSize=e.pageSize,this.pageNumber=e.pageNumber,this.currentPage=e.pageNumber,this.maximumResults=e.maximumResults??1/0,e.eager&&(this.more(),this.isEager=!0)}createDataObservable(){return this.dataSubject.asObservable()}wasMaximumResultsExceeded(){return this.currentPage*this._pageSize>this.maximumResults}makeHttpRequest(){return this.http.get(this.url,{params:$(T({},this.queryParameters),{page:this.currentPage,size:this._pageSize})})}newRequest(){return this.wasMaximumResultsExceeded()?x([]):this.factory?this.makeHttpRequest().pipe(g(e=>this.factory(e))):this.makeHttpRequest()}get pageSize(){return this._pageSize}more(){if(!this.isComplete){if(this.isEager){this.isEager=!1;return}this.newRequest().pipe(P(e=>(this.currentPage--,this.dataSubject.error(e),this._isComplete=!0,x([]))),U(1),L(()=>this.currentPage++)).subscribe(e=>this.dataSubject.next(e))}}refresh(){this.isEager=!1,this._isComplete=!1,this.dataSubject.complete(),this.dataSubject=new a(1),this.data$=this.createDataObservable()}reset(){this.currentPage=this.pageNumber,this.refresh()}complete(){this.dataSubject.complete(),this._isComplete=!0}get isComplete(){return this._isComplete}};var C=class{constructor(e){this._elements=[],this.nextSubject=new a(1),this.errorSubject=new a(1),this.completeSubject=new a(1),this.resetSubject=new a(1),this.next$=this.nextSubject.asObservable(),this.error$=this.errorSubject.asObservable(),this.complete$=this.completeSubject.asObservable(),this.reset$=this.resetSubject.asObservable(),this.dataObserver={next:i=>{this._elements.push(...i),this.nextSubject.next(i)},error:i=>{this.errorSubject.next(i)},complete:()=>{this.completeSubject.next()}},this.request=new m(e),this.subscribeToData()}get pageSize(){return this.request.pageSize}get elements(){return this._elements}get editableElements(){return this._elements}more(){this.request.more()}refresh(){this.request.refresh(),this.subscribeToData()}subscribeUninterrupted(e){let i=new z;return e.next&&i.add(this.next$.subscribe(e.next)),e.error&&i.add(this.error$.subscribe(e.error)),e.complete&&i.add(this.complete$.subscribe(e.complete)),e.reset&&i.add(this.reset$.subscribe(e.reset)),i}reset(e){this.unsubscribeFromData(),this.resetSubject.next(),this._elements.length=0,e?(this.request.complete(),this.request=new m(e)):this.request.reset(),this.subscribeToData()}get isComplete(){return this.request.isComplete}clear(){this.request.complete(),this.nextSubject.complete(),this.errorSubject.complete(),this.completeSubject.complete(),this.resetSubject.complete()}subscribeToData(){this.dataSubscription=this.request.data$.subscribe(this.dataObserver)}unsubscribeFromData(){this.dataSubscription?.unsubscribe()}};var Fe=(()=>{let e=class e{get notifications(){return this.request.elements}constructor(r,s){this.http=r,this.authentication=s,this._lockRefreshCounter=0,this._notificationsCount=0,this._unreadNotificationsCount=0,this.unreadNotificationsSubject=new a(1),this.unreadNotificationsCount$=this.unreadNotificationsSubject.asObservable().pipe(g(()=>this._unreadNotificationsCount)),this.loadingEndedSubject=new B,this.loadingEnded$=this.loadingEndedSubject.asObservable(),this.request=new C({http:this.http,url:`${h.backendHost}/notifications/all`,factory:d=>(this.notificationsCount=d.notificationsCounter,this.unreadNotificationsCount=d.unreadNotifications,me.buildArray(d.notifications.filter(ge=>this.notifications.find(be=>be.id===ge.id)===void 0))),queryParameters:{},pageNumber:1,pageSize:e.PAGE_SIZE,eager:!1});let n=this.loadingEndedSubject.next.bind(this.loadingEndedSubject);this.request.subscribeUninterrupted({next:n,error:n,complete:n,reset:n}),this.authentication.isLogged$.pipe(M(d=>d)).subscribe(()=>{this.refresh()})}refresh(){this._lockRefreshCounter>0||(this.request.reset(),this.more())}more(){if(this.request.isComplete){this.loadingEndedSubject.next();return}this.request.more()}markAsRead(r){r.read||(r.read=!0,this.unreadNotificationsCount--,this.http.post(`${h.backendHost}/notifications/mark-as-read?notificationId=${r.id}`,{}).subscribe())}markAllAsRead(){this.notifications.forEach(r=>r.read=!0),this.unreadNotificationsCount=0,this.http.post(`${h.backendHost}/notifications/read`,{}).subscribe()}deleteOne(r){let s=this.notifications.findIndex(n=>n.id===r.id);s!==-1&&(r.read||this.unreadNotificationsCount--,this.request.editableElements.splice(s,1),this.http.delete(`${h.backendHost}/notifications/mark-as-eliminated?notificationId=${r.id}`).subscribe())}deleteAll(){this.request.editableElements.splice(0,this.notifications.length),this.unreadNotificationsCount=0,this.http.delete(`${h.backendHost}/notifications`).subscribe()}get unreadNotificationsCount(){return this._unreadNotificationsCount}get isComplete(){return this.request?.isComplete??!0}lockRefresh(r){r?this._lockRefreshCounter++:this._lockRefreshCounter--}get notificationsCount(){return this._notificationsCount}set notificationsCount(r){this._notificationsCount=r}set unreadNotificationsCount(r){this._unreadNotificationsCount=r>=0?r:0,this.unreadNotificationsSubject.next()}};e.PAGE_SIZE=9,e.\u0275fac=function(s){return new(s||e)(y(ue),y(he))},e.\u0275prov=H({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var _e=["*"];function Ce(t,e){if(t&1&&(f(0,"span",4),ie(1),_()),t&2){let i=l();S(),re(i.label)}}function xe(t,e){if(t&1&&Z(0,"span",6),t&2){let i=l(2);v(i.icon),c("ngClass","p-avatar-icon")}}function ye(t,e){if(t&1&&b(0,xe,1,3,"span",5),t&2){let i=l(),r=I(6);c("ngIf",i.icon)("ngIfElse",r)}}function Se(t,e){if(t&1){let i=K();f(0,"img",8),Q("error",function(s){G(i);let n=l(2);return W(n.imageError(s))}),_()}if(t&2){let i=l(2);c("src",i.image,X),E("aria-label",i.ariaLabel)}}function Ee(t,e){if(t&1&&b(0,Se,1,2,"img",7),t&2){let i=l();c("ngIf",i.image)}}var rt=(()=>{class t{label;icon;image;size="normal";shape="square";style;styleClass;ariaLabel;ariaLabelledBy;onImageError=new J;containerClass(){return{"p-avatar p-component":!0,"p-avatar-image":this.image!=null,"p-avatar-circle":this.shape==="circle","p-avatar-lg":this.size==="large","p-avatar-xl":this.size==="xlarge"}}imageError(i){this.onImageError.emit(i)}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=V({type:t,selectors:[["p-avatar"]],hostAttrs:[1,"p-element"],inputs:{label:"label",icon:"icon",image:"image",size:"size",shape:"shape",style:"style",styleClass:"styleClass",ariaLabel:"ariaLabel",ariaLabelledBy:"ariaLabelledBy"},outputs:{onImageError:"onImageError"},ngContentSelectors:_e,decls:7,vars:9,consts:[["iconTemplate",""],["imageTemplate",""],[3,"ngClass","ngStyle"],["class","p-avatar-text",4,"ngIf","ngIfElse"],[1,"p-avatar-text"],[3,"class","ngClass",4,"ngIf","ngIfElse"],[3,"ngClass"],[3,"src","error",4,"ngIf"],[3,"error","src"]],template:function(r,s){if(r&1&&(ee(),f(0,"div",2),te(1),b(2,Ce,2,1,"span",3)(3,ye,1,2,"ng-template",null,0,j)(5,Ee,1,1,"ng-template",null,1,j),_()),r&2){let n=I(4);v(s.styleClass),c("ngClass",s.containerClass())("ngStyle",s.style),E("aria-labelledby",s.ariaLabelledBy)("aria-label",s.ariaLabel)("data-pc-name","avatar"),S(2),c("ngIf",s.label)("ngIfElse",n)}},dependencies:[se,ne,ae],styles:[`@layer primeng{.p-avatar{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;font-size:1rem}.p-avatar.p-avatar-image{background-color:transparent}.p-avatar.p-avatar-circle{border-radius:50%;overflow:hidden}.p-avatar .p-avatar-icon{font-size:1rem}.p-avatar img{width:100%;height:100%}}
`],encapsulation:2,changeDetection:0})}return t})(),st=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=F({type:t});static \u0275inj=Y({imports:[oe]})}return t})();export{p as a,pe as b,C as c,Fe as d,rt as e,st as f};
