import{d as ct,e as lt}from"./chunk-V3XZAR6W.js";import{s as ht}from"./chunk-VZ7YMVIL.js";import{a as h}from"./chunk-24P7UAVE.js";import{a as j}from"./chunk-2CJT4ORM.js";import{e as st,g as nt,h as at,n as ot,t as ut}from"./chunk-27INX3PV.js";import{$b as it,Ca as G,Da as W,Db as v,F as M,H as P,Jb as f,Ka as J,Kb as _,L as U,Lb as Z,Pb as K,Sb as Q,Tb as l,Ub as tt,Vb as et,_b as w,a as T,aa as L,ab as X,ac as rt,b as $,e as B,eb as S,ha as H,ia as Y,j as z,l as a,ma as y,q as x,sa as V,ta as F,u as g,ub as b,uc as I,yb as E,zb as c}from"./chunk-I3PUZZLM.js";var p=class{constructor(t){this.factory=t}buildSingle(t){return this.factory(t)}buildArray(t){return t.map(i=>this.factory(i))}};var pt=new p(e=>{switch(e.type){case j.silent:return new ct(e);case j.reverse:return new lt(e);default:throw new Error("Invalid auction DTO")}});var u=function(e){return e.AUCTION_OVER="auction-over",e.AUCTION_EXPIRED="auction-expired",e.AUCTION_ABORTED="auction-aborted",e.NEW_BID="new-bid",e.OUT_BID="out-bid",e.WINNING_BID="winning-bid",e.BID_REJECTED="bid-rejected",e}(u||{}),o=class{constructor(t){this._id=t.id,this._type=t.notificationType,this._read=t.read,this._auction=t.auction?pt.buildSingle(t.auction):null}get id(){return this._id}get type(){return this._type}get read(){return this._read}set read(t){this._read=t}get auction(){return this._auction}},R=class extends o{constructor(t){super(t)}get heading(){return this.auction?.title??"An auction ended"}get message(){return"Your auction awaits a conclusion"}get link(){return["/auction/conclusion",this.auction?.id]}},D=class extends o{constructor(t){super(t)}get heading(){return this.auction?.title??"An auction expired"}get message(){return"The winning bid was automatically rejected"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},A=class extends o{constructor(t){super(t)}get heading(){return this.auction?.title??"An auction was deleted"}get message(){return"The auction was deleted by its creator"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},k=class extends o{constructor(t){super(t)}get heading(){return this.auction?.title??"A new bid"}get message(){return"You have new bids for your auction"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},q=class extends o{constructor(t){super(t)}get heading(){return this.auction?.title??"Outbid"}get message(){return"You have been outbid"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},N=class extends o{constructor(t){super(t)}get heading(){return this.auction?.title??"Winning bid"}get message(){return`Your bid${this.auction?.winningBid===null||!this.auction?.currency?"":` of CURRENCY{${this.auction?.winningBid}|${this.auction?.currency}}`} won`}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},O=class extends o{constructor(t){super(t)}get heading(){return this.auction?.title??"Bid rejected"}get message(){return`Your bid${this.auction?.winningBid===null||!this.auction?.currency?"":` of CURRENCY{${this.auction?.winningBid}|${this.auction?.currency}}`} has been rejected`}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},dt=new Map([[u.AUCTION_OVER,R],[u.AUCTION_EXPIRED,D],[u.AUCTION_ABORTED,A],[u.NEW_BID,k],[u.OUT_BID,q],[u.WINNING_BID,N],[u.BID_REJECTED,O]]);var mt=new p(e=>{let t=dt.get(e.notificationType);if(!t)throw new Error("Invalid notification DTO");return new t(e)});var m=class{constructor(t){this.dataSubject=new a(1),this.isEager=!1,this._isComplete=!1,this.data$=this.createDataObservable(),this.http=t.http,this.url=t.url,this.factory=t.factory,this.queryParameters=t.queryParameters,this._pageSize=t.pageSize,this.pageNumber=t.pageNumber,this.currentPage=t.pageNumber,this.maximumResults=t.maximumResults??1/0,t.eager&&(this.more(),this.isEager=!0)}createDataObservable(){return this.dataSubject.asObservable()}wasMaximumResultsExceeded(){return this.currentPage*this._pageSize>this.maximumResults}makeHttpRequest(){return this.http.get(this.url,{params:$(T({},this.queryParameters),{page:this.currentPage,size:this._pageSize})})}newRequest(){return this.wasMaximumResultsExceeded()?x([]):this.factory?this.makeHttpRequest().pipe(g(t=>this.factory(t))):this.makeHttpRequest()}get pageSize(){return this._pageSize}more(){if(!this.isComplete){if(this.isEager){this.isEager=!1;return}this.newRequest().pipe(P(t=>(this.currentPage--,this.dataSubject.error(t),this._isComplete=!0,x([]))),U(1),L(()=>this.currentPage++)).subscribe(t=>this.dataSubject.next(t))}}refresh(){this.isEager=!1,this._isComplete=!1,this.dataSubject.complete(),this.dataSubject=new a(1),this.data$=this.createDataObservable()}reset(){this.currentPage=this.pageNumber,this.refresh()}complete(){this.dataSubject.complete(),this._isComplete=!0}get isComplete(){return this._isComplete}};var C=class{constructor(t){this._elements=[],this.nextSubject=new a(1),this.errorSubject=new a(1),this.completeSubject=new a(1),this.resetSubject=new a(1),this.next$=this.nextSubject.asObservable(),this.error$=this.errorSubject.asObservable(),this.complete$=this.completeSubject.asObservable(),this.reset$=this.resetSubject.asObservable(),this.dataObserver={next:i=>{this._elements.push(...i),this.nextSubject.next(i)},error:i=>{this.errorSubject.next(i)},complete:()=>{this.completeSubject.next()}},this.request=new m(t),this.subscribeToData()}get pageSize(){return this.request.pageSize}get elements(){return this._elements}get editableElements(){return this._elements}more(){this.request.more()}refresh(){this.request.refresh(),this.subscribeToData()}subscribeUninterrupted(t){let i=new B;return t.next&&i.add(this.next$.subscribe(t.next)),t.error&&i.add(this.error$.subscribe(t.error)),t.complete&&i.add(this.complete$.subscribe(t.complete)),t.reset&&i.add(this.reset$.subscribe(t.reset)),i}reset(t){this.unsubscribeFromData(),this.resetSubject.next(),this._elements.length=0,t?(this.request.complete(),this.request=new m(t)):this.request.reset(),this.subscribeToData()}get isComplete(){return this.request.isComplete}clear(){this.request.complete(),this.nextSubject.complete(),this.errorSubject.complete(),this.completeSubject.complete(),this.resetSubject.complete()}subscribeToData(){this.dataSubscription=this.request.data$.subscribe(this.dataObserver)}unsubscribeFromData(){this.dataSubscription?.unsubscribe()}};var Ft=(()=>{let t=class t{get notifications(){return this.request.elements}constructor(r,s){this.http=r,this.authentication=s,this._lockRefreshCounter=0,this._notificationsCount=0,this._unreadNotificationsCount=0,this.unreadNotificationsSubject=new a(1),this.unreadNotificationsCount$=this.unreadNotificationsSubject.asObservable().pipe(g(()=>this._unreadNotificationsCount)),this.loadingEndedSubject=new z,this.loadingEnded$=this.loadingEndedSubject.asObservable(),this.request=new C({http:this.http,url:`${h.backendHost}/notifications/all`,factory:d=>(this.notificationsCount=d.notificationsCounter,this.unreadNotificationsCount=d.unreadNotifications,mt.buildArray(d.notifications.filter(gt=>this.notifications.find(bt=>bt.id===gt.id)===void 0))),queryParameters:{},pageNumber:1,pageSize:t.PAGE_SIZE,eager:!1});let n=this.loadingEndedSubject.next.bind(this.loadingEndedSubject);this.request.subscribeUninterrupted({next:n,error:n,complete:n,reset:n}),this.authentication.isLogged$.pipe(M(d=>d)).subscribe(()=>{this.refresh()})}refresh(){this._lockRefreshCounter>0||(this.request.reset(),this.more())}more(){if(this.request.isComplete){this.loadingEndedSubject.next();return}this.request.more()}markAsRead(r){r.read||(r.read=!0,this.unreadNotificationsCount--,this.http.post(`${h.backendHost}/notifications/mark-as-read?notificationId=${r.id}`,{}).subscribe())}markAllAsRead(){this.notifications.forEach(r=>r.read=!0),this.unreadNotificationsCount=0,this.http.post(`${h.backendHost}/notifications/mark-all-as-read`,{}).subscribe()}deleteOne(r){let s=this.notifications.findIndex(n=>n.id===r.id);s!==-1&&(r.read||this.unreadNotificationsCount--,this.request.editableElements.splice(s,1),this.http.delete(`${h.backendHost}/notifications/mark-as-eliminated?notificationId=${r.id}`).subscribe())}deleteAll(){this.request.editableElements.splice(0,this.notifications.length),this.unreadNotificationsCount=0,this.http.delete(`${h.backendHost}/notifications/mark-all-as-eliminated`).subscribe()}get unreadNotificationsCount(){return this._unreadNotificationsCount}get isComplete(){return this.request?.isComplete??!0}lockRefresh(r){r?this._lockRefreshCounter++:this._lockRefreshCounter--}get notificationsCount(){return this._notificationsCount}set notificationsCount(r){this._notificationsCount=r}set unreadNotificationsCount(r){this._unreadNotificationsCount=r>=0?r:0,this.unreadNotificationsSubject.next()}};t.PAGE_SIZE=9,t.\u0275fac=function(s){return new(s||t)(y(ut),y(ht))},t.\u0275prov=H({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var _t=["*"];function Ct(e,t){if(e&1&&(f(0,"span",4),it(1),_()),e&2){let i=l();S(),rt(i.label)}}function xt(e,t){if(e&1&&Z(0,"span",6),e&2){let i=l(2);v(i.icon),c("ngClass","p-avatar-icon")}}function yt(e,t){if(e&1&&b(0,xt,1,3,"span",5),e&2){let i=l(),r=w(6);c("ngIf",i.icon)("ngIfElse",r)}}function St(e,t){if(e&1){let i=K();f(0,"img",8),Q("error",function(s){G(i);let n=l(2);return W(n.imageError(s))}),_()}if(e&2){let i=l(2);c("src",i.image,X),E("aria-label",i.ariaLabel)}}function Et(e,t){if(e&1&&b(0,St,1,2,"img",7),e&2){let i=l();c("ngIf",i.image)}}var re=(()=>{class e{label;icon;image;size="normal";shape="square";style;styleClass;ariaLabel;ariaLabelledBy;onImageError=new J;containerClass(){return{"p-avatar p-component":!0,"p-avatar-image":this.image!=null,"p-avatar-circle":this.shape==="circle","p-avatar-lg":this.size==="large","p-avatar-xl":this.size==="xlarge"}}imageError(i){this.onImageError.emit(i)}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=V({type:e,selectors:[["p-avatar"]],hostAttrs:[1,"p-element"],inputs:{label:"label",icon:"icon",image:"image",size:"size",shape:"shape",style:"style",styleClass:"styleClass",ariaLabel:"ariaLabel",ariaLabelledBy:"ariaLabelledBy"},outputs:{onImageError:"onImageError"},ngContentSelectors:_t,decls:7,vars:9,consts:[["iconTemplate",""],["imageTemplate",""],[3,"ngClass","ngStyle"],["class","p-avatar-text",4,"ngIf","ngIfElse"],[1,"p-avatar-text"],[3,"class","ngClass",4,"ngIf","ngIfElse"],[3,"ngClass"],[3,"src","error",4,"ngIf"],[3,"error","src"]],template:function(r,s){if(r&1&&(tt(),f(0,"div",2),et(1),b(2,Ct,2,1,"span",3)(3,yt,1,2,"ng-template",null,0,I)(5,Et,1,1,"ng-template",null,1,I),_()),r&2){let n=w(4);v(s.styleClass),c("ngClass",s.containerClass())("ngStyle",s.style),E("aria-labelledby",s.ariaLabelledBy)("aria-label",s.ariaLabel)("data-pc-name","avatar"),S(2),c("ngIf",s.label)("ngIfElse",n)}},dependencies:[st,nt,at],styles:[`@layer primeng{.p-avatar{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;font-size:1rem}.p-avatar.p-avatar-image{background-color:transparent}.p-avatar.p-avatar-circle{border-radius:50%;overflow:hidden}.p-avatar .p-avatar-icon{font-size:1rem}.p-avatar img{width:100%;height:100%}}
`],encapsulation:2,changeDetection:0})}return e})(),se=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=F({type:e});static \u0275inj=Y({imports:[ot]})}return e})();export{p as a,pt as b,C as c,Ft as d,re as e,se as f};
