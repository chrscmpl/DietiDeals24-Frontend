import{d as le,e as he}from"./chunk-DF4H5URN.js";import{s as pe}from"./chunk-VAUY7UXL.js";import{a as d}from"./chunk-FNDQBP77.js";import{a as z}from"./chunk-2CJT4ORM.js";import{e as ne,g as ae,h as oe,n as ue,t as ce}from"./chunk-27INX3PV.js";import{$b as re,Ca as W,Da as J,Db as I,F as U,H as L,Jb as C,Ka as X,Kb as x,L as H,Lb as K,Pb as Q,Sb as ee,Tb as l,Ub as te,Vb as ie,_b as j,a as $,aa as F,ab as Z,ac as se,b as B,e as M,eb as E,ha as h,ia as Y,j as P,l as a,ma as p,q as v,sa as V,ta as G,u as b,ub as _,uc as w,yb as S,zb as c}from"./chunk-I3PUZZLM.js";var g=class{constructor(e){this.dataSubject=new a(1),this.isEager=!1,this._isComplete=!1,this.data$=this.createDataObservable(),this.http=e.http,this.url=e.url,this.deserializer=e.deserializer,this.queryParameters=e.queryParameters,this._pageSize=e.pageSize,this.pageNumber=e.pageNumber,this.currentPage=e.pageNumber,this.maximumResults=e.maximumResults??1/0,e.eager&&(this.more(),this.isEager=!0)}createDataObservable(){return this.dataSubject.asObservable()}wasMaximumResultsExceeded(){return this.currentPage*this._pageSize>this.maximumResults}makeHttpRequest(){return this.http.get(this.url,{params:B($({},this.queryParameters),{page:this.currentPage,size:this._pageSize})})}newRequest(){return this.wasMaximumResultsExceeded()?v([]):this.deserializer?this.makeHttpRequest().pipe(b(e=>this.deserializer?.(e)??e)):this.makeHttpRequest()}get pageSize(){return this._pageSize}more(){if(!this.isComplete){if(this.isEager){this.isEager=!1;return}this.newRequest().pipe(L(e=>(this.currentPage--,this.dataSubject.error(e),this._isComplete=!0,v([]))),H(1),F(()=>this.currentPage++)).subscribe(e=>this.dataSubject.next(e))}}refresh(){this.isEager=!1,this._isComplete=!1,this.dataSubject.complete(),this.dataSubject=new a(1),this.data$=this.createDataObservable()}reset(){this.currentPage=this.pageNumber,this.refresh()}complete(){this.dataSubject.complete(),this._isComplete=!0}get isComplete(){return this._isComplete}};var y=class{constructor(e){this._elements=[],this.nextSubject=new a(1),this.errorSubject=new a(1),this.completeSubject=new a(1),this.resetSubject=new a(1),this.next$=this.nextSubject.asObservable(),this.error$=this.errorSubject.asObservable(),this.complete$=this.completeSubject.asObservable(),this.reset$=this.resetSubject.asObservable(),this.dataObserver={next:r=>{this._elements.push(...r),this.nextSubject.next(r)},error:r=>{this.errorSubject.next(r)},complete:()=>{this.completeSubject.next()}},this.request=new g(e),this.subscribeToData()}get pageSize(){return this.request.pageSize}get elements(){return this._elements}get editableElements(){return this._elements}more(){this.request.more()}refresh(){this.request.refresh(),this.subscribeToData()}subscribeUninterrupted(e){let r=new M;return e.next&&r.add(this.next$.subscribe(e.next)),e.error&&r.add(this.error$.subscribe(e.error)),e.complete&&r.add(this.complete$.subscribe(e.complete)),e.reset&&r.add(this.reset$.subscribe(e.reset)),r}reset(e){this.unsubscribeFromData(),this.resetSubject.next(),this._elements.length=0,e?(this.request.complete(),this.request=new g(e)):this.request.reset(),this.subscribeToData()}get isComplete(){return this.request.isComplete}clear(){this.request.complete(),this.nextSubject.complete(),this.errorSubject.complete(),this.completeSubject.complete(),this.resetSubject.complete()}subscribeToData(){this.dataSubscription=this.request.data$.subscribe(this.dataObserver)}unsubscribeFromData(){this.dataSubscription?.unsubscribe()}};var u=function(t){return t.AUCTION_OVER="auction-over",t.AUCTION_EXPIRED="auction-expired",t.AUCTION_ABORTED="auction-aborted",t.NEW_BID="new-bid",t.OUT_BID="out-bid",t.WINNING_BID="winning-bid",t.BID_REJECTED="bid-rejected",t}(u||{}),o=class{constructor(e){this._auction=null,this._id=e.id,this._type=e.notificationType,this._read=e.read}get id(){return this._id}get type(){return this._type}get read(){return this._read}set read(e){this._read=e}get auction(){return this._auction}set auction(e){this._auction=e}},R=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"An auction ended"}get message(){return"Your auction awaits a conclusion"}get link(){return["/auction/conclusion",this.auction?.id]}},D=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"An auction expired"}get message(){return"The winning bid was automatically rejected"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},k=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"An auction was deleted"}get message(){return"The auction was deleted by its creator"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},A=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"A new bid"}get message(){return"You have new bids for your auction"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},q=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"Outbid"}get message(){return"You have been outbid"}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},N=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"Winning bid"}get message(){return`Your bid${this.auction?.winningBid===null||!this.auction?.currency?"":` of CURRENCY{${this.auction?.winningBid}|${this.auction?.currency}}`} won`}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},O=class extends o{constructor(e){super(e)}get heading(){return this.auction?.title??"Bid rejected"}get message(){return`Your bid${this.auction?.winningBid===null||!this.auction?.currency?"":` of CURRENCY{${this.auction?.winningBid}|${this.auction?.currency}}`} has been rejected`}get link(){return[{outlets:{overlay:["auctions",this.auction?.id]}}]}},de=new Map([[u.AUCTION_OVER,R],[u.AUCTION_EXPIRED,D],[u.AUCTION_ABORTED,k],[u.NEW_BID,A],[u.OUT_BID,q],[u.WINNING_BID,N],[u.BID_REJECTED,O]]);var me=(()=>{let e=class e{deserialize(i){switch(i.type){case z.silent:return new le(i);case z.reverse:return new he(i);default:throw new Error("Invalid auction DTO")}}deserializeArray(i){return i.map(s=>this.deserialize(s))}};e.\u0275fac=function(s){return new(s||e)},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var ge=(()=>{let e=class e{constructor(i){this.auctionDeserializer=i}deserialize(i){let s=de.get(i.notificationType);if(!s)throw new Error("Invalid notification DTO");let n=new s(i);return i.auction&&(n.auction=this.auctionDeserializer.deserialize(i.auction)),n}deserializeArray(i){return i.map(s=>this.deserialize(s))}};e.\u0275fac=function(s){return new(s||e)(p(me))},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var Ue=(()=>{let e=class e{get notifications(){return this.request.elements}constructor(i,s,n){this.http=i,this.authentication=s,this.deserializer=n,this._lockRefreshCounter=0,this._notificationsCount=0,this._unreadNotificationsCount=0,this.unreadNotificationsSubject=new a(1),this.unreadNotificationsCount$=this.unreadNotificationsSubject.asObservable().pipe(b(()=>this._unreadNotificationsCount)),this.loadingEndedSubject=new P,this.loadingEnded$=this.loadingEndedSubject.asObservable(),this.request=new y({http:this.http,url:`${d.backendHost}/notifications/all`,deserializer:m=>(this.notificationsCount=m.notificationsCounter,this.unreadNotificationsCount=m.unreadNotifications,this.deserializer.deserializeArray(m.notifications.filter(fe=>this.notifications.find(be=>be.id===fe.id)===void 0))),queryParameters:{},pageNumber:1,pageSize:e.PAGE_SIZE,eager:!1});let f=this.loadingEndedSubject.next.bind(this.loadingEndedSubject);this.request.subscribeUninterrupted({next:f,error:f,complete:f,reset:f}),this.authentication.isLogged$.pipe(U(m=>m)).subscribe(()=>{this.refresh()})}refresh(){this._lockRefreshCounter>0||(this.request.reset(),this.more())}more(){if(this.request.isComplete){this.loadingEndedSubject.next();return}this.request.more()}markAsRead(i){i.read||(i.read=!0,this.unreadNotificationsCount--,this.http.post(`${d.backendHost}/notifications/mark-as-read?notificationId=${i.id}`,{}).subscribe())}markAllAsRead(){this.notifications.forEach(i=>i.read=!0),this.unreadNotificationsCount=0,this.http.post(`${d.backendHost}/notifications/mark-all-as-read`,{}).subscribe()}deleteOne(i){let s=this.notifications.findIndex(n=>n.id===i.id);s!==-1&&(i.read||this.unreadNotificationsCount--,this.request.editableElements.splice(s,1),this.http.delete(`${d.backendHost}/notifications/mark-as-eliminated?notificationId=${i.id}`).subscribe())}deleteAll(){this.request.editableElements.splice(0,this.notifications.length),this.unreadNotificationsCount=0,this.http.delete(`${d.backendHost}/notifications/mark-all-as-eliminated`).subscribe()}get unreadNotificationsCount(){return this._unreadNotificationsCount}get isComplete(){return this.request?.isComplete??!0}lockRefresh(i){i?this._lockRefreshCounter++:this._lockRefreshCounter--}get notificationsCount(){return this._notificationsCount}set notificationsCount(i){this._notificationsCount=i}set unreadNotificationsCount(i){this._unreadNotificationsCount=i>=0?i:0,this.unreadNotificationsSubject.next()}};e.PAGE_SIZE=9,e.\u0275fac=function(s){return new(s||e)(p(ce),p(pe),p(ge))},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var xe=["*"];function ye(t,e){if(t&1&&(C(0,"span",4),re(1),x()),t&2){let r=l();E(),se(r.label)}}function ve(t,e){if(t&1&&K(0,"span",6),t&2){let r=l(2);I(r.icon),c("ngClass","p-avatar-icon")}}function Ee(t,e){if(t&1&&_(0,ve,1,3,"span",5),t&2){let r=l(),i=j(6);c("ngIf",r.icon)("ngIfElse",i)}}function Se(t,e){if(t&1){let r=Q();C(0,"img",8),ee("error",function(s){W(r);let n=l(2);return J(n.imageError(s))}),x()}if(t&2){let r=l(2);c("src",r.image,Z),S("aria-label",r.ariaLabel)}}function Ie(t,e){if(t&1&&_(0,Se,1,2,"img",7),t&2){let r=l();c("ngIf",r.image)}}var Ke=(()=>{class t{label;icon;image;size="normal";shape="square";style;styleClass;ariaLabel;ariaLabelledBy;onImageError=new X;containerClass(){return{"p-avatar p-component":!0,"p-avatar-image":this.image!=null,"p-avatar-circle":this.shape==="circle","p-avatar-lg":this.size==="large","p-avatar-xl":this.size==="xlarge"}}imageError(r){this.onImageError.emit(r)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=V({type:t,selectors:[["p-avatar"]],hostAttrs:[1,"p-element"],inputs:{label:"label",icon:"icon",image:"image",size:"size",shape:"shape",style:"style",styleClass:"styleClass",ariaLabel:"ariaLabel",ariaLabelledBy:"ariaLabelledBy"},outputs:{onImageError:"onImageError"},ngContentSelectors:xe,decls:7,vars:9,consts:[["iconTemplate",""],["imageTemplate",""],[3,"ngClass","ngStyle"],["class","p-avatar-text",4,"ngIf","ngIfElse"],[1,"p-avatar-text"],[3,"class","ngClass",4,"ngIf","ngIfElse"],[3,"ngClass"],[3,"src","error",4,"ngIf"],[3,"error","src"]],template:function(i,s){if(i&1&&(te(),C(0,"div",2),ie(1),_(2,ye,2,1,"span",3)(3,Ee,1,2,"ng-template",null,0,w)(5,Ie,1,1,"ng-template",null,1,w),x()),i&2){let n=j(4);I(s.styleClass),c("ngClass",s.containerClass())("ngStyle",s.style),S("aria-labelledby",s.ariaLabelledBy)("aria-label",s.ariaLabel)("data-pc-name","avatar"),E(2),c("ngIf",s.label)("ngIfElse",n)}},dependencies:[ne,ae,oe],styles:[`@layer primeng{.p-avatar{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;font-size:1rem}.p-avatar.p-avatar-image{background-color:transparent}.p-avatar.p-avatar-circle{border-radius:50%;overflow:hidden}.p-avatar .p-avatar-icon{font-size:1rem}.p-avatar img{width:100%;height:100%}}
`],encapsulation:2,changeDetection:0})}return t})(),Qe=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=G({type:t});static \u0275inj=Y({imports:[ue]})}return t})();export{y as a,me as b,Ue as c,Ke as d,Qe as e};
