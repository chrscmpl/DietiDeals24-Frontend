import{g as S,t as v}from"./chunk-AR6ESCK6.js";import{v as k}from"./chunk-6MRKP2W7.js";import{F as y,H as u,_ as b,aa as x,ca as j,ha as n,l as c,ma as a,r as l,u as h}from"./chunk-I3PUZZLM.js";var o=class{constructor(e){this.error=e}};var p=class extends o{constructor(e){super(e)}};var g=class extends o{constructor(e){super(e)}};var m=class extends o{constructor(e){super(e)}};var f=class extends o{constructor(e){super(e)}};var d=class{constructor(e){this._id=String(e.userId),this._username=e.username,this._name=e.name,this._surname=e.surname,this._birthday=e.birthday,this._email=e.email,this._onlineAuctionsCounter=e.onlineAuctionsCounter??0,this._pastDealsCounter=e.pastDealsCounter??0,this._profilePictureUrl=e.profilePictureUrl??null,this._country=e.country??null,this._city=e.city??null,this._bio=e.bio??null,this._links=e.links??[]}get id(){return this._id}get username(){return this._username}get name(){return this._name}get surname(){return this._surname}get birthday(){return this._birthday}get email(){return this._email}get onlineAuctionsCounter(){return this._onlineAuctionsCounter}get pastDealsCounter(){return this._pastDealsCounter}get profilePictureUrl(){return this._profilePictureUrl}get country(){return this._country}get city(){return this._city}get bio(){return this._bio}get links(){return this._links}},U=class{constructor(e){this._id=e.userId,this._username=e.username,this._profilePictureUrl=e.profilePictureUrl,this._location={country:e.country,city:e.city}}get id(){return this._id}get username(){return this._username}get profilePictureUrl(){return this._profilePictureUrl}get location(){return this._location}};var _=(()=>{let e=class e{deserialize(t){return new d(t)}deserializeArray(t){return t.map(i=>this.deserialize(i))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var I=(()=>{let e=class e{serialize(t){return v({birthday:new Date(t.birthday.getTime()-t.birthday.getTimezoneOffset()*6e4).toISOString().split(".")[0]+"Z"},t)}serializeArray(t){return t.map(i=>this.serialize(i))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var w=(()=>{let e=class e{serialize(t){return t}serializeArray(t){return t.map(i=>this.serialize(i))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var W=(()=>{let e=class e{get isLogged(){return this._isLogged}get loggedUser(){return this._loggedUser}constructor(t,i,s,T,L){this.http=t,this.deserializer=i,this.registrationSerializer=s,this.emailVerificationSerializer=T,this.messageService=L,this._isLogged=!1,this._loggedUser=null,this._initialized=!1,this.emailToVerify=null,this.initializedSubject=new c(1),this.loggedUserSubject=new c(1),this.isLoggedSubject=new c(1),this.isLogged$=this.isLoggedSubject.asObservable().pipe(h(()=>this.isLogged)),this.loggedUser$=this.loggedUserSubject.asObservable().pipe(j(this.isLogged$),y(()=>this.isLogged),h(()=>this.loggedUser)),this.initialized$=this.initializedSubject.asObservable(),this.isLoggedSubject.next(),e.authorizationToken?this.getUserDataObservable().subscribe():this.setInitialized()}login(t,i){this.http.post("login",t,{observe:"response"}).pipe(u(s=>l(()=>new p(s))),b(s=>(e.extractToken(s),this.getUserDataObservable()))).subscribe(i)}register(t,i){this.http.post("register/init",this.registrationSerializer.serialize(t),{responseType:"text"}).pipe(u(s=>l(()=>new m(s)))).subscribe(i)}verifyEmail(t,i){this.http.post("register/confirm",this.emailVerificationSerializer.serialize(t),{observe:"response"}).pipe(u(s=>l(()=>new f(s))),b(s=>(e.extractToken(s),this.getUserDataObservable()))).subscribe(i)}getUserDataObservable(){return this.http.get("profile/owner-view").pipe(h(t=>this.deserializer.deserialize(t)),x(this.setLoggedUser.bind(this)),u(t=>(this.setInitialized(),t.status>=400&&t.status<500&&e.authorizationToken&&(e.authorizationToken=null,this.showExpiredTokenError()),l(()=>new g(t)))))}logout(){e.authorizationToken=null,this._isLogged=!1,this._loggedUser=null,this.isLoggedSubject.next()}setLoggedUser(t){this.setInitialized(),this._isLogged=!0,this._loggedUser=t,this.isLoggedSubject.next(),this.loggedUserSubject.next()}setInitialized(){this._initialized||(this._initialized=!0,this.initializedSubject.next())}showExpiredTokenError(){this.messageService.add({severity:"error",summary:"Session expired",detail:"Your session has expired. Please log in again."})}static extractToken(t){let i=t.headers.get("X-Auth-Token");i&&(this.authorizationToken=i)}static set authorizationToken(t){t?localStorage.setItem("authorizationToken",t):localStorage.removeItem("authorizationToken")}static get authorizationToken(){return localStorage.getItem("authorizationToken")}};e.\u0275fac=function(i){return new(i||e)(a(k),a(_),a(I),a(w),a(S))},e.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();export{o as a,U as b,W as c};
